<?xml version="1.0" encoding="UTF-8"?>
<svg width="1200" height="600" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .box { fill: #ffffff; stroke: #0b3d91; stroke-width: 2; }
      .register { fill: #e3f2fd; stroke: #0b3d91; stroke-width: 2; }
      .text { font-family: Arial, sans-serif; font-size: 14px; fill: #1f2d3d; }
      .title { font-family: Arial, sans-serif; font-size: 16px; font-weight: bold; fill: #0b3d91; }
      .small-text { font-family: Arial, sans-serif; font-size: 12px; fill: #5b6b7c; }
      .signal { fill: none; stroke: #0b3d91; stroke-width: 2; marker-end: url(#arrowhead); }
      .clock-signal { fill: none; stroke: #d32f2f; stroke-width: 2; stroke-dasharray: 5,5; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#0b3d91" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="600" y="30" text-anchor="middle" class="title" font-size="20">Two-Stage Pipelined Floating Point Multiplier Architecture</text>
  
  <!-- Stage 1 Label -->
  <text x="200" y="70" text-anchor="middle" class="title">Stage 1: Multiply and Add</text>
  
  <!-- Stage 2 Label -->
  <text x="850" y="70" text-anchor="middle" class="title">Stage 2: Normalize and Select</text>
  
  <!-- Input Signals -->
  <rect x="20" y="100" width="80" height="40" class="box" rx="5"/>
  <text x="60" y="125" text-anchor="middle" class="text">a[31:0]</text>
  
  <rect x="20" y="160" width="80" height="40" class="box" rx="5"/>
  <text x="60" y="185" text-anchor="middle" class="text">b[31:0]</text>
  
  <rect x="20" y="220" width="80" height="40" class="box" rx="5"/>
  <text x="60" y="245" text-anchor="middle" class="text">valid_in</text>
  
  <!-- Stage 1 Input Registers -->
  <rect x="140" y="120" width="100" height="100" class="register" rx="5"/>
  <text x="190" y="145" text-anchor="middle" class="text" font-weight="bold">Input Regs</text>
  <text x="190" y="165" text-anchor="middle" class="small-text">a_r[31:0]</text>
  <text x="190" y="185" text-anchor="middle" class="small-text">b_r[31:0]</text>
  <text x="190" y="205" text-anchor="middle" class="small-text">valid_r</text>
  
  <!-- Field Extraction Block -->
  <rect x="140" y="250" width="100" height="80" class="box" rx="5"/>
  <text x="190" y="275" text-anchor="middle" class="text" font-weight="bold">Field</text>
  <text x="190" y="295" text-anchor="middle" class="text" font-weight="bold">Extractor</text>
  <text x="190" y="315" text-anchor="middle" class="small-text">S, E, F</text>
  
  <!-- Special Case Detector -->
  <rect x="140" y="350" width="100" height="60" class="box" rx="5"/>
  <text x="190" y="375" text-anchor="middle" class="text" font-weight="bold">Special Case</text>
  <text x="190" y="395" text-anchor="middle" class="text" font-weight="bold">Detector</text>
  
  <!-- Sign Calculator -->
  <rect x="270" y="100" width="100" height="50" class="box" rx="5"/>
  <text x="320" y="125" text-anchor="middle" class="text" font-weight="bold">Sign XOR</text>
  <text x="320" y="140" text-anchor="middle" class="small-text">S_y = S_a ⊕ S_b</text>
  
  <!-- Exponent Adder -->
  <rect x="270" y="170" width="100" height="60" class="box" rx="5"/>
  <text x="320" y="195" text-anchor="middle" class="text" font-weight="bold">Exp Adder</text>
  <text x="320" y="215" text-anchor="middle" class="small-text">E_y = E_a+E_b-127</text>
  
  <!-- Vedic 24x24 Multiplier -->
  <rect x="270" y="250" width="100" height="100" class="box" rx="5"/>
  <text x="320" y="280" text-anchor="middle" class="text" font-weight="bold">Vedic 24×24</text>
  <text x="320" y="300" text-anchor="middle" class="text" font-weight="bold">Multiplier</text>
  <text x="320" y="320" text-anchor="middle" class="small-text">man_a × man_b</text>
  <text x="320" y="335" text-anchor="middle" class="small-text">(48-bit product)</text>
  
  <!-- Pipeline Register Bank -->
  <rect x="500" y="90" width="120" height="350" class="register" rx="5"/>
  <text x="560" y="115" text-anchor="middle" class="title">Pipeline Regs</text>
  <text x="560" y="145" text-anchor="middle" class="small-text">mant_r[22:0]</text>
  <text x="560" y="165" text-anchor="middle" class="small-text">expu_r[9:0]</text>
  <text x="560" y="185" text-anchor="middle" class="small-text">sign_r_r</text>
  <text x="560" y="215" text-anchor="middle" class="small-text">a_zero_r</text>
  <text x="560" y="235" text-anchor="middle" class="small-text">b_zero_r</text>
  <text x="560" y="255" text-anchor="middle" class="small-text">a_inf_r</text>
  <text x="560" y="275" text-anchor="middle" class="small-text">b_inf_r</text>
  <text x="560" y="295" text-anchor="middle" class="small-text">a_nan_r</text>
  <text x="560" y="315" text-anchor="middle" class="small-text">b_nan_r</text>
  <text x="560" y="345" text-anchor="middle" class="small-text">valid_stage1</text>
  
  <!-- Clock signal to pipeline registers -->
  <line x1="560" y1="460" x2="560" y2="440" class="clock-signal"/>
  <text x="480" y="490" class="small-text" fill="#d32f2f">clk</text>
  
  <!-- Stage 2 Components -->
  
  <!-- Normalizer -->
  <rect x="700" y="120" width="120" height="80" class="box" rx="5"/>
  <text x="760" y="150" text-anchor="middle" class="text" font-weight="bold">Normalizer</text>
  <text x="760" y="170" text-anchor="middle" class="small-text">Check MSB</text>
  <text x="760" y="185" text-anchor="middle" class="small-text">Adjust exponent</text>
  
  <!-- Priority Selector (MUX) -->
  <rect x="700" y="220" width="120" height="120" class="box" rx="5"/>
  <text x="760" y="245" text-anchor="middle" class="text" font-weight="bold">Priority</text>
  <text x="760" y="265" text-anchor="middle" class="text" font-weight="bold">Selector</text>
  <text x="760" y="290" text-anchor="middle" class="small-text">1. NaN check</text>
  <text x="760" y="305" text-anchor="middle" class="small-text">2. Inf check</text>
  <text x="760" y="320" text-anchor="middle" class="small-text">3. Zero check</text>
  <text x="760" y="335" text-anchor="middle" class="small-text">4. Normal result</text>
  
  <!-- Output Register -->
  <rect x="900" y="200" width="100" height="80" class="register" rx="5"/>
  <text x="950" y="225" text-anchor="middle" class="text" font-weight="bold">Output Reg</text>
  <text x="950" y="245" text-anchor="middle" class="small-text">y[31:0]</text>
  <text x="950" y="265" text-anchor="middle" class="small-text">valid_out</text>
  
  <!-- Output Signals -->
  <rect x="1070" y="210" width="100" height="40" class="box" rx="5"/>
  <text x="1120" y="235" text-anchor="middle" class="text">y[31:0]</text>
  
  <rect x="1070" y="270" width="100" height="40" class="box" rx="5"/>
  <text x="1120" y="295" text-anchor="middle" class="text">valid_out</text>
  
  <!-- Arrows/Connections -->
  <!-- Stage 1 inputs to registers -->
  <path d="M 100 120 L 140 150" class="signal"/>
  <path d="M 100 180 L 140 170" class="signal"/>
  <path d="M 100 240 L 140 200" class="signal"/>
  
  <!-- Registers to field extractor -->
  <path d="M 190 220 L 190 250" class="signal"/>
  
  <!-- Field extractor to special case -->
  <path d="M 190 330 L 190 350" class="signal"/>
  
  <!-- Field extractor to functional units -->
  <path d="M 240 290 L 270 125" class="signal"/>
  <path d="M 240 290 L 270 200" class="signal"/>
  <path d="M 240 290 L 270 300" class="signal"/>
  
  <!-- Functional units to pipeline registers -->
  <path d="M 370 125 L 500 200" class="signal"/>
  <path d="M 370 200 L 500 220" class="signal"/>
  <path d="M 370 300 L 500 240" class="signal"/>
  <path d="M 240 380 L 500 260" class="signal"/>
  
  <!-- Pipeline registers to Stage 2 -->
  <path d="M 620 150 L 700 150" class="signal"/>
  <path d="M 620 200 L 700 280" class="signal"/>
  <path d="M 620 260 L 700 290" class="signal"/>
  
  <!-- Normalizer to selector -->
  <path d="M 760 200 L 760 220" class="signal"/>
  
  <!-- Selector to output register -->
  <path d="M 820 280 L 900 240" class="signal"/>
  
  <!-- Output register to outputs -->
  <path d="M 1000 230 L 1070 230" class="signal"/>
  <path d="M 1000 250 L 1040 250 L 1040 290 L 1070 290" class="signal"/>
  
  <!-- Legend -->
  <rect x="20" y="500" width="300" height="80" fill="none" stroke="#999" stroke-width="1"/>
  <text x="30" y="520" class="text" font-weight="bold">Legend:</text>
  <rect x="30" y="530" width="40" height="20" class="box"/>
  <text x="80" y="545" class="small-text">Combinational Logic</text>
  <rect x="30" y="560" width="40" height="20" class="register"/>
  <text x="80" y="575" class="small-text">Registers (D Flip-Flops)</text>
  
</svg>
